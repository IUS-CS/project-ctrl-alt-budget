<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Budget App Prototype</title>

  <!-- Example JS/CSS library you can keep using later -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    body { background: #0b0f14; color: #e8eef5; }
    .card-dark { background: #121a24; border: 1px solid #1f2a3a; }
    .form-control, .form-select { background: #0b0f14; color: #e8eef5; border: 1px solid #2a3a52; }
    .table td, .table th { border-color: #1f2a3a; }
    .muted { color: #a8b3c2; }
  </style>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand">CTRL+ALT Budget</span>
  </nav>

  <main class="container py-4">
    <h1 class="h3 mb-1">Budget Prototype Page</h1>
    <p class="muted mb-4">
      Prototype only. No database yet. This page shows the UI and the planned API calls.
    </p>

    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="card card-dark">
          <div class="card-body">
            <div class="muted">Income</div>
            <div id="incomeTotal" class="display-6">$0.00</div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-dark">
          <div class="card-body">
            <div class="muted">Expenses</div>
            <div id="expenseTotal" class="display-6">$0.00</div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card card-dark">
          <div class="card-body">
            <div class="muted">Balance</div>
            <div id="balanceTotal" class="display-6">$0.00</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card card-dark mb-4">
      <div class="card-body">
        <h2 class="h5 mb-3">Add Transaction (stub)</h2>

        <form id="txForm" class="row g-3">
          <div class="col-md-3">
            <label class="form-label">Date</label>
            <input id="date" type="date" class="form-control" required />
          </div>

          <div class="col-md-4">
            <label class="form-label">Description</label>
            <input id="desc" type="text" class="form-control" placeholder="Example: Rent" required />
          </div>

          <div class="col-md-2">
            <label class="form-label">Type</label>
            <select id="type" class="form-select">
              <option value="EXPENSE" selected>EXPENSE</option>
              <option value="INCOME">INCOME</option>
            </select>
          </div>

          <div class="col-md-3">
            <label class="form-label">Amount</label>
            <input id="amount" type="number" step="0.01" class="form-control" placeholder="12.99" required />
          </div>

          <div class="col-12 d-flex gap-2">
            <button class="btn btn-primary" type="submit">Submit</button>
            <span id="msg" class="muted align-self-center"></span>
          </div>
        </form>

        <hr class="border-secondary" />

        <div class="muted">
          Planned backend endpoints (not implemented yet):
          <ul class="mb-0">
            <li><code>GET /api/transactions</code> loads recent transactions</li>
            <li><code>POST /api/transactions</code> creates a transaction and saves to the database</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="card card-dark">
      <div class="card-body">
        <h2 class="h5 mb-3">Recent Transactions (mock)</h2>

        <div class="table-responsive">
          <table class="table table-dark table-striped align-middle">
            <thead>
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Type</th>
                <th class="text-end">Amount</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Prototype behavior:
    // - Uses mock data now
    // - Shows planned fetch() calls for the real backend later

    const mockTxs = [
      { date: "2026-02-20", desc: "Paycheck", type: "INCOME", amount: 500 },
      { date: "2026-02-21", desc: "Rent", type: "EXPENSE", amount: 300 },
      { date: "2026-02-22", desc: "Gas", type: "EXPENSE", amount: 45.5 }
    ];

    const rowsEl = document.getElementById("rows");
    const incomeEl = document.getElementById("incomeTotal");
    const expenseEl = document.getElementById("expenseTotal");
    const balanceEl = document.getElementById("balanceTotal");
    const msgEl = document.getElementById("msg");

    document.getElementById("date").valueAsDate = new Date();

    render(mockTxs);

    document.getElementById("txForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      msgEl.textContent = "";

      const tx = {
        date: document.getElementById("date").value,
        desc: document.getElementById("desc").value.trim(),
        type: document.getElementById("type").value,
        amount: Number(document.getElementById("amount").value)
      };

      if (!tx.date || !tx.desc || !Number.isFinite(tx.amount) || tx.amount <= 0) {
        msgEl.textContent = "Fill out all fields correctly.";
        return;
      }

      // Planned real call later:
      // await fetch("/api/transactions", {
      //   method: "POST",
      //   headers: { "Content-Type": "application/json" },
      //   body: JSON.stringify(tx)
      // });

      // For prototype: just show it worked and add to mock list.
      mockTxs.unshift(tx);
      render(mockTxs);

      e.target.reset();
      document.getElementById("date").valueAsDate = new Date();
      document.getElementById("type").value = "EXPENSE";
      msgEl.textContent = "Prototype submit: added to mock list (no DB yet).";
    });

    function render(txs) {
      rowsEl.innerHTML = "";

      let income = 0;
      let expenses = 0;

      for (const t of txs) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${escapeHtml(t.date)}</td>
          <td>${escapeHtml(t.desc)}</td>
          <td>${escapeHtml(t.type)}</td>
          <td class="text-end">$${Number(t.amount).toFixed(2)}</td>
        `;
        rowsEl.appendChild(tr);

        if (t.type === "INCOME") income += Number(t.amount);
        else expenses += Number(t.amount);
      }

      const balance = income - expenses;
      incomeEl.textContent = `$${income.toFixed(2)}`;
      expenseEl.textContent = `$${expenses.toFixed(2)}`;
      balanceEl.textContent = `$${balance.toFixed(2)}`;
    }

    function escapeHtml(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }
  </script>
</body>
</html>
